#!/usr/bin/make -f

# only enable jack on i386 and powerpc (See #406754)
DEB_HOST_ARCH_CPU ?= $(shell dpkg-architecture -qDEB_HOST_ARCH_CPU)
ifeq (,$(filter $(DEB_HOST_ARCH_CPU),i386 amd64 powerpc))
WITH_JACK_CONFFLAG := --with-jack=yes
else
WITH_JACK_CONFFLAG := --with-jack=no
endif

DEB_CONFIGURE_EXTRA_FLAGS := \
	$(WITH_JACK_CONFFLAG) \
	--enable-unicode \
	--with-expat=system \
	--with-ffmpeg=system \
	--with-libflac=system \
	--with-libid3tag=system \
	--with-libmad=system \
	--with-libsamplerate=system \
	--without-libresample \
	--with-libsndfile=system \
	--with-libtwolame=system \
	--with-libvamp=system \
	--with-libvorbis=system \
	--with-portaudio=v19 \
	--with-portmixer \
	--with-soundtouch=system \
	$(null)

# Do not link against unused libraries (make dpkg-shlibdeps happy).
LDFLAGS += -Wl,-z,defs -Wl,--as-needed

%:
	dh --parallel $@

override_dh_auto_install:
	dh_auto_install
	# Don't package unnecessary copy of GPL
	rm -f debian/tmp/usr/share/doc/audacity/LICENSE.txt
